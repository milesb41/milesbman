<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collaborative Pixel Art</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .controls { margin-bottom: 20px; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: flex; gap: 15px; align-items: center; }
        
        /* Grid setup: 20x20 squares */
        #canvas { 
            display: grid; 
            grid-template-columns: repeat(20, 20px); 
            grid-template-rows: repeat(20, 20px); 
            gap: 1px; 
            background: #ddd; 
            border: 2px solid #333;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .pixel { 
            width: 20px; 
            height: 20px; 
            background: white; 
            cursor: crosshair; 
        }
        .pixel:hover { filter: brightness(0.9); }
        
        input[type="color"] { border: none; width: 40px; height: 40px; cursor: pointer; background: none; }
        h2 { margin-top: 0; color: #333; }
    </style>
</head>
<body>

    <div class="controls">
        <h2>ðŸŽ¨ Pixel Canvas</h2>
        <label>Pick Color:</label>
        <input type="color" id="colorPicker" value="#1a73e8">
        <small>Click squares to draw!</small>
    </div>

    <div id="canvas"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAOhxc2fAsuSNZhnOiqQE9uJHhtG9ONr6o",
            authDomain: "suggestions-2bc1c.firebaseapp.com",
            projectId: "suggestions-2bc1c",
            storageBucket: "suggestions-2bc1c.firebasestorage.app",
            messagingSenderId: "624122500508",
            appId: "1:624122500508:web:bea268bd6616529ffee459"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const canvasSize = 20; // 20x20 grid

        // 1. Generate the Grid in HTML
        const canvas = document.getElementById('canvas');
        const pixels = {};

        for (let i = 0; i < canvasSize * canvasSize; i++) {
            const pixel = document.createElement('div');
            pixel.className = 'pixel';
            pixel.id = `p${i}`;
            pixel.onclick = () => paintPixel(i);
            canvas.appendChild(pixel);
            pixels[i] = pixel;
        }

        // 2. Paint Function (Save to Firebase)
        window.paintPixel = async (index) => {
            const color = document.getElementById('colorPicker').value;
            try {
                // We store each pixel as its own document in a "canvas" collection
                await setDoc(doc(db, "canvas", `pixel_${index}`), {
                    color: color,
                    index: index
                });
            } catch (e) {
                console.error("Error painting:", e);
            }
        };

        // 3. Real-time Listener (Update colors when anyone draws)
        onSnapshot(doc(db, "canvas", "pixel_data"), (snapshot) => {
            // Note: For a small grid, we can also use a single document to store everything
        });

        // Optimized Listener: Listen for all pixel changes
        import { collection } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        onSnapshot(collection(db, "canvas"), (snap) => {
            snap.forEach(change => {
                const data = change.data();
                if (pixels[data.index]) {
                    pixels[data.index].style.background = data.color;
                }
            });
        });
    </script>
</body>
</html>