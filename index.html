<!DOCTYPE html>
<html>
<head>
<meta name="author" content="Miles">
<meta charset="UTF-8">
<title>Miles' Portal </title>
<link rel="stylesheet" href="index.css">
<script>
// ---------------- Redirects ----------------
const path = window.location.pathname.toLowerCase();
const redirects = {
"/milescomp": "https://pcpartpicker.com/list/xmww2x",
"/lethal": "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
"/nice": "nice.html",
"/suggestions": "suggestions.html"
};

if (redirects[path]) {
window.location.href = redirects[path];
}

// ---------------- Location Tracking ----------------
const SHEET_URL = "https://script.google.com/macros/s/AKfycbxMrkQjLGQlcMUB0bFcx5y5wkDvJKlkgd7uc9I8ojJcI1ibBkiKHf4Dl41Aj2yKJ9y_eQ/exec";

// Function to send data to the Google Sheet
function sendData(timestamp, ip, latitude, longitude) {
    const row = [timestamp, ip, latitude, longitude];
    fetch(SHEET_URL, {
        method: "POST",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(row)
    })
    .then(res => res.text())
    .then(msg => console.log("Saved to Google Sheets:", msg))
    .catch(err => console.error("Error saving:", err));
}

// Fetch public IP address (returns null on failure)
async function getIP() {
    try {
        const res = await fetch('https://api.ipify.org?format=json');
        if (!res.ok) throw new Error('IP fetch failed');
        const json = await res.json();
        return json.ip || null;
    } catch (e) {
        console.warn('Could not retrieve IP:', e);
        return null;
    }
}

// Collect tracking data (timestamp, ip, latitude, longitude) and send
function collectAndSendTracking() {
    (async () => {
        const ip = await getIP();
        const timestamp = new Date().toISOString();
        let latitude = null;
        let longitude = null;

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition((pos) => {
                latitude = pos.coords.latitude;
                longitude = pos.coords.longitude;
                sendData(timestamp, ip, latitude, longitude);
            }, (err) => {
                // If geolocation denied or fails, send without coords
                console.warn('Geolocation unavailable:', err);
                sendData(timestamp, ip, latitude, longitude);
            }, { timeout: 5000 });
        } else {
            sendData(timestamp, ip, latitude, longitude);
        }
    })();
}

// Send tracking data on page load
collectAndSendTracking();



</script>
<script>
    function filterLinks(category) {
        const links = document.querySelectorAll('.link');

        links.forEach(link => {
            if (category === 'all') {
                link.style.display = 'block';
            } else {
                link.style.display = link.classList.contains(category) 
                ? 'block' 
                : 'none';
            }
        });
    }
</script>
</head>
<body>
<h1>Welcome To The Portal</h1>
<p>By: Miles</p>
<br>
<br>
<label for="filter">Filter Links</label>

<select id="filter" onchange="filterLinks(this.value)">
  <option value="all">All</option>
  <option value="miles">Miles</option>
  <option value="other">Other</option>
</select>

<div class="links">
    <a href="#" class="link miles">Miles' Link 1</a>
    <a href="#" class="link other">Other's Link 1</a>  
</div>
<footer>
<a class="Sbutton" href="suggestions.html">Suggestions</a>
</footer>
</body>
</html>
<!DOCTYPE html>